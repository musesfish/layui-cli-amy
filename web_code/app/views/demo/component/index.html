<title>组件</title>

<style>
    .demo-page textarea {
        border: 0;
        width: 100%;
        min-height: 120px;
    }
    .content-anchor {
        background-color: yellow;
    }
    .content-anchor.this-anchor {
        background-color: greenyellow
    }
</style>

<div class="layui-fluid demo-page">
    <div class="layui-card hide">
        <div class="content-box" style="line-height: 32px;">
            文章，<span style="color:red">1984年6月26日</span>出生于陕西省西安市，中国内地男演员、导演，毕业于中央戏剧学院表演系。2004年，参演电视剧《与青春有关的日子》，开始在影视圈崭露头角 [1]  。2005年，拍摄古装剧《锦衣卫》。2007年，主演赵宝刚导演的青春剧《奋斗》 [2]  ；同年，主演首部电影《走着瞧》。2008年，主演滕华涛执导的电视剧《蜗居》，饰演80后城市青年小贝 [1]  。2009年，在电影《海洋天堂》中扮演自闭症患者王大福；同年，参演抗战剧《雪豹》 [3]  。2011年，主演的电视剧《裸婚时代》播出 [4]  ；同年，连续2年获得北京大学生电影节 [5-6]  最受大学生欢迎男演员奖。2012年，凭借电影《失恋33天》获得第31届大众电影百花奖最佳男主角奖 [7]  ；同年，成立北京君竹影视文化有限公司，并导演第一部影视作品《小爸爸》。2013年2月，主演的电影《西游·降魔篇》在全国上映 [8]  。2014年3月28日，主演的文艺爱情片《我在路上最爱你》在全国上映。2014年12月18日，在姜文执导的动作喜剧片《一步之遥》中扮演武七一角。2016年，主演电视剧《少帅》 [9]  和《剃刀边缘》 [10]  。2017年9月16日，凭借导演的电影《陆垚知马俐》获得第31届中国电影金鸡奖导演处女作奖 [11-12]  。2018年9月30日，主演的喜剧动作电影《胖子行动队》上映 [13]  。2021年8月20日，主演的电影《测谎人》上映。 [67] </div>
        <input type="text" class="layui-input j-search-content">
        <div class="mt-10">
            <button class="layui-btn" id="prev-anchor">上一个</button>
            <span class="anchor-nums">0 / 0</span>
            <button class="layui-btn" id="next-anchor">下一个</button>
        </div>
    </div>
    <div class="layui-collapse layui-card" lay-accordion>
        <fieldset class="layui-elem-field site-demo-button" style="margin-top: 30px;">
            <legend>UI组件</legend>

            <div class="layui-colla-item pad-10" style="border: 0;">
                <h3>样式控件</h3>
                <div class="jin-btn-query mr-10"></div>
                <div class="jin-btn-reset mr-10"></div>
                <div class="jin-btn-submit"></div>
                <div class="layui-row mt-10">
                    <div class="jin-btn-tag_add"></div> 标签增加按钮 jin-btn-tag_add 
                </div>
                <div class="layui-row mt-10">
                    <div class="jin-btn-add"></div><div class="jin-btn-del ml-10"></div> 列表操作按钮 jin-btn-add jin-btn-del 
                </div>
                <ul class="layui-row flex">
                    <li class="tag-process-status " data-status="-1"></li>
                    <li class="tag-process-status  ml-10" data-status="0"></li>
                    <li class="tag-process-status  ml-10" data-status="1"></li>
                    <li class="tag-process-status  ml-10" data-status="2"></li>
                    <li class="tag-process-status  ml-10" data-status="3"></li>
                    <li class="tag-process-status  ml-10" data-status="4"></li>
                </ul>
                <hr>

                <h3>Layui第三方控件</h3>
                <div class="layui-row mt-10">
                    <label for="" class="layui-form-label"><a class="fc-blue" href="https://gitee.com/moretop/layui-select-ext" target="_blank">selectM文档</a></label>
                    <div class="layui-input-block">
                        <div class="select-input pos-relative"></div>
                    </div>
                </div>
                <hr>

                <h3>事件控件</h3>
                <div class="layui-row mt-10">
                    <p>上传附件</p>
                    <div class="jin-btn-upload"></div> 文件 jin-btn-upload
                    <div class="jin-btn-upload" data-accept="images"></div> 图片 jin-btn-upload[data-accept="images"]
                    <p>附件预览</p>
                    <div class="flex flex-wrap">
                        <div class="demo-pre-file"></div>
                        <div class="demo-pre-img"></div>
                    </div>
                </div>
                <div class="layui-row mt-10">
                    <p>上传附件（小）</p>
                    <div class="jin-btn-info-upload"></div> jin-btn-info-upload 
                    <div class="jin-btn-info-upload-pic"></div> jin-btn-info-upload-pic
                </div>
    

            <div class="layui-row mt-10">
                <table class="layui-table form-table">
                    <tr>
                        <td width=80><b></b></td>
                        <td>&lt;b&gt;&lt;/b&gt; 在.layui-table td 下为红色字体的节点，内容为*</td>
                    </tr>
                    <tr>
                        <td><h3>标题</h3></td>
                        <td>h3 为页面内标题</td>
                    </tr>
                </table>
            </div>
        </fieldset>


        <fieldset class="layui-elem-field site-demo-button mt-30">
            <legend>功能组件</legend>
            <div class="pad-lr-20">
                <div class="layui-colla-item">
                    <h3>layer</h3>
                    <table class="layui-table form-table">
                        <colgroup>
                            <col width="160">
                            <col>
                        </colgroup>
                        <tr>
                            <td>1. layer-theme-default</td>
                            <td> 
                                <div class="pad-10">
                                    <p> <span class="layui-btn" id="j-pop-con">详情弹层</span> </p>
                                    <h3 class="layui-colla-title">查看代码</h3>
                                    <code class="layui-colla-content">
                                        <textarea data-code="openCon" cols="30" rows="10" readonly ></textarea>
                                    </code>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>2. layer-theme-select</td>
                            <td>
                                <div class="pad-10">
                                    <p><span class="layui-btn" id="j-pop-select">弹层（小）</span></p>
                                    <h3 class="layui-colla-title">查看代码</h3>
                                    <code class="layui-colla-content">
                                        <textarea data-code="openSelectCon" cols="30" rows="10" readonly ></textarea>
                                    </code>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="layui-colla-item mt-20">
                    <div class="layui-form-item layui-form">
                        <label class="layui-form-label">服务类型：</label>
                        <div class="layui-input-block j-sel-business">
                            <div class="z-business-type-wrap j-business-wrap"></div>
                            <input type="hidden" class="layui-input j-business-ids" value="1,2" name="seciperId">
                        </div>
                        <div class="mt-20">
                            <button class="layui-btn" lay-submit lay-filter="demo1">获取数据</button>
                            <button class="layui-btn ml-20" lay-submit lay-filter="demo2">更新/设置</button>
                        </div>
                    </div>
                    <h3 class="layui-colla-title">查看代码</h3>
                    <code class="layui-colla-content">
                    <textarea cols="30" rows="10" readonly >
                            引入样式
                            layui.link("../../../../static/css/component/page/day-bookturnover.css")
                            初始化
                            layui.selService.init(view, { data: MOCK_DATA })
                            获取数据
                            layui.selService.getField()
                            设置/更新
                            layui.selService.setToNewsIds({
                                "auditBusiness": '3',
                                "businessBusiness": '3',
                                "financialBusiness": '3',
                                "otherBusiness": '3'
                            })
                    </textarea>
                    </code>
                </div>

                <div class="layui-colla-item mt-20">
                    <div class="layui-form-item layui-form">
                        <label class="layui-form-label">日历复选：</label>
                        <div class="layui-input-block j-sel-business">
                            <div class="date-time layui-input"></div>
                            <input type="hidden" class="date-time layui-input" placeholder="input" />
                        </div>
                    </div>
                    <h3 class="layui-colla-title">查看代码</h3>
                    <code class="layui-colla-content">
                    <textarea cols="30" rows="10" readonly >
                            // 详见文件 /app/controller/calendar.js
                            layui.calendar({
                                target: ".date-time",   // query
                                min: +new Date(),   // 最小日期
                                select: ['2020-11-05'] // 初始选中
                                callback: function(dom, result){
                                    // dom 触发容器
                                    // result return [yyyy-mm-dd] // 选中的日期集合
                                    if(dom.tagName === 'INPUT'){
                                        dom.value = result.join(",")
                                    } else {
                                        dom.innerHTML = result.join(",")
                                    }
                                }
                            })
                    </textarea>
                    </code>
                </div>
                </div>
        </fieldset>

        <fieldset class="layui-elem-field site-demo-button" style="margin-top: 30px;">
            <legend>复选多选一</legend>
            <div class="layui-colla-item pad-10" style="border: 0;">
                <div class="layui-form-item">
                    <div class="layui-input-block layui-form pt-20">
                        <input type="checkbox" name="tab" title="写作" lay-filter="formChekcked" value="1" lay-skin="primary">
                        <input type="checkbox" name="tab" title="发呆" lay-filter="formChekcked" value="2" lay-skin="primary"> 
                        <input type="checkbox" name="tab" title="禁用" lay-filter="formChekcked" value="3" lay-skin="primary"> 
                    </div>
                </div>
                <h3 class="layui-colla-title">查看代码</h3>
                <code class="layui-colla-content">
                    <textarea cols="30" rows="10" readonly >
                        // html
                        <input type="checkbox" name="tab" title="写作" lay-filter="formChekcked" value="1" lay-skin="primary">
                        <input type="checkbox" name="tab" title="发呆" lay-filter="formChekcked" value="2" lay-skin="primary"> 
                        <input type="checkbox" name="tab" title="禁用" lay-filter="formChekcked" value="3" lay-skin="primary"> 
                        // js
                        form.on('checkbox(formChekcked)', function(data){
                            const checked = data.elem.checked
                            $(data.othis).siblings('input:checkbox').prop('checked', false);
                            $(data.othis).prev('input:checkbox').prop('checked', checked )
                            form.render()
                        })
                    </textarea>
                </code>
            </div>
        </fieldset>

        <fieldset class="layui-elem-field site-demo-button" style="margin-top: 30px;">
            <legend>下载</legend>
            <div class="layui-colla-item pad-10" style="border: 0;">
                <div class="layui-form-item">
                    <div class="layui-btn" id="j-download-file" >下载</div>
                </div>
                <h3 class="layui-colla-title">查看代码</h3>
                <code class="layui-colla-content">
                    <textarea data-code="downloadCode" cols="30" rows="10" readonly ></textarea>
                </code>
            </div>
        </fieldset>

        <fieldset class="layui-elem-field site-demo-button" style="margin-top: 30px;">
            <legend>导出表格</legend>
            <div class="layui-colla-item pad-10" style="border: 0;">
                <div class="layui-form-item">
                    <div class="layui-btn" id="j-exports-xlsx" >导出表格</div>
                </div>
                <h3 class="layui-colla-title">查看代码</h3>
                <code class="layui-colla-content">
                    <textarea data-code="handleExportXLSX" cols="30" rows="10" readonly ></textarea>
                </code>
            </div>
        </fieldset>
    </div>
</div>

<script>
    layui.use(['jquery', 'element', 'form', 'calendar', 'ajax', 'renders', 'selService', 'download', 'renders', 'upload', 'utils', 'XLSX', 'selectM'], function(){
        const $ = layui.jquery;
        const { renders, selectM, form, element } = layui;

        const view = $(".layadmin-tabsbody-item.layui-show");

        // 文本搜索
        function handleSearchFeat(opt={input: '.j-search-content', nextBtn: '#next-anchor', prevBtn: '#prev-anchor', nums: '.anchor-nums'}){
            const handleSearch = (function(){
                const node = $('.content-box');
                const selector = 'content-anchor';
                const this_selector = 'this-anchor';
                const selectorClass = `.${selector}`;
                const this_selectorClass = `.${this_selector}`
                const nodeNums = document.querySelector(opt.nums)
                let content = node.html();
                let timer;
                let thisAnchor = 0;
                let maxAnchor = 0;
                let isSearch = false;
                $(document).on('click', opt.prevBtn, function(e){
                    if (isSearch) return false;
                    let prevNode = $(this_selectorClass).prev(selectorClass);
                    if (prevNode.length === 0) prevNode = $(selectorClass).last();
                    $(selectorClass).removeClass(this_selector)
                    prevNode.addClass(this_selector)
                    const ind = prevNode.index();
                    nodeNums.innerHTML = `${ind} / ${maxAnchor}`
                })
                $(document).on('click', opt.nextBtn, function(e) {
                    if (isSearch) return false;
                    let nextNode = $(this_selectorClass).next(selectorClass);
                    if (nextNode.length === 0)  nextNode = $(selectorClass).first();
                    $(selectorClass).removeClass(this_selector);
                    nextNode.addClass(this_selector)
                    const ind = nextNode.index();
                    nodeNums.innerHTML = `${ind} / ${maxAnchor}`
                })
                return function(e){
                    const tar = e.target;
                    const value = tar.value.replace(/(\<|\>)/g, '');
                    const reg = new RegExp(`(${value})`, 'g')
                    isSearch = true;
                    let result = content;
                    if (value) {
                        let ind = -1;
                        result = content.replace(reg, function(match, p1, index){
                            ind++;
                            maxAnchor = ind+1;
                            return `<a class="${selector} ${ind === 0 ? this_selector: ''}">${match}</a>`
                        })
                    }
                    nodeNums.innerHTML = `1 / ${maxAnchor}`
                    clearTimeout(timer);
                    timer = setTimeout(function(){
                        isSearch = false;
                        node.html(result);
                    }, 1e2) 
                }
            }())

            $(document).on('input', opt.input, handleSearch)
        }
        handleSearchFeat()
        // 文本搜索 End

        // .date-time 添加日历
        layui.calendar({
            target: ".date-time",
            min: +new Date(),
            select: ['2020-11-02', '2020-11-05'],
            // maskclose: false,
            callback: function(dom, result){
                if(dom.tagName === 'INPUT'){
                    dom.value = result.join(",")
                } else {
                    dom.innerHTML = result.join(",")
                }
            }
        })
        // 主动触发
        // $('.date-time').trigger('click')
        
        element.render()
        form.render()

        const MOCK_DATA = {
            "auditBusiness": '1,2',
            "businessBusiness": '1,2',
            "financialBusiness": '1,2',
            "otherBusiness": '1,2'
        }

        layui.link("../../../../static/css/component/page/day-bookturnover.css")
        layui.selService.init(view, { data: MOCK_DATA })

        view.on("dblclick", '.layui-colla-content textarea', function(){
            this.select()
            const self = this;
            document.addEventListener('copy', function(e){
                e.clipboardData.setData('text/plain', self.value);
                e.preventDefault();
            });    
            document.execCommand("copy");
        })

        // 获取数据
        form.on('submit(demo1)', function(d){
            let data = d.field;
            data = Object.assign(data, layui.selService.getField());
            layer.alert(JSON.stringify(data))
            return false;
        })

        // 设置/更新
        form.on("submit(demo2)", function(d){
            layui.selService.setToNewsIds({
                "auditBusiness": '3',
                "businessBusiness": '3',
                "financialBusiness": '3',
                "otherBusiness": '3'
            })
            return false;
        })

        form.render()
        form.on('checkbox(formChekcked)', function(data){
            const checked = data.elem.checked
            $(data.othis).siblings('input:checkbox').prop('checked', false);
            $(data.othis).prev('input:checkbox').prop('checked', checked )
            form.render()
        })

        function openCon(){
            renders.con({
                title: '标题',
                content: '/app/views/personnel/staff/revise.html?id=1871&m=1&v1634178022454'
            })
        }

        function openSelectCon(){
            renders.con({
                type: 2,
                title: '添加',
                content: 'views/customer/customize/order/add.html?types=1',
                area: ['580px', '620px'],
                skin: 'layer-theme-select',
            })
        }

        // 下载
        function downloadCode(){
            const el = $('#j-download-file');
            el.on('click', function(){
                layui.download('下载文件', 'xxxx.xlsx', 'text/plain')
            })
        }
        downloadCode()

        const funcCode = {
            downloadCode,
            openCon,
            openSelectCon,
            handleExportXLSX
        }

        // 循环渲染方法
        $('textarea[data-code]').each(function(index, item){
            item.innerHTML = funcCode[item.dataset.code].toString()
        })

        $('#j-pop-con').on('click', openCon)
        $('#j-pop-select').on('click', openSelectCon)

        // 附件
        layui.renders.fileTags('.demo-pre-file', 'abc,bb.xlxs,bb.pdf,bb.word,bb.txt')
        layui.renders.fileTags('.demo-pre-img', 'acb.jpg')
        layui.renders.upload()
        layui.renders.upload({elem: '.jin-btn-info-upload', type: 'small'})
        layui.renders.upload({elem: '.jin-btn-info-upload-pic', type: 'small'})

        function handleExportXLSX(){
            layui.utils.exportXLSX({
                count: 10,
                url: "/customer/getPublicCustomer",
                where: {  },
                cols: [
                    { title: '编号', type: 'numbers' },
                    { field: 'contactInformation', title: '客户名称' },
                    { field: 'address', title: '地址' },
                    { field: 'customerName', title: '法人姓名' },
                    { field: 'contactInformation', title: '电话'}
                ],
                filename: `示例`,
                // 插入数据行
                handleDataList: function(list) {
                    return [
                        ['测试一'],
                        ['测试二'],
                        ['测试三'],
                        ...list
                    ]
                },
                // 单元格合并
                beforeFunc: function(ws){
                    const merge = [
                        { s: { r: 0, c: 0 }, e: { r: 0, c: 3 } },
                        { s: { r: 1, c: 0 }, e: { r: 1, c: 3 } },
                        { s: { r: 2, c: 0 }, e: { r: 2, c: 3 } }
                    ]
                    ws['!merges'] = merge;
                }
            })
        }
        $('#j-exports-xlsx').on('click', handleExportXLSX)

        selectM({
            elem: ".select-input",
            data: [{"id":12,"name":"长者","status":0},{"id":13,"name":"工厂"},{"id":14,"name":"小学生"},{"id":15,"name":"大学生"},{"id":16,"name":"研究生"},{"id":17,"name":"教师"},{"id":18,"name":"记者"}],
        })

        form.render()
    })
</script>